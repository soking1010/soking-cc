$(function(){$('.swipebox').swipebox()});$(function(){$('#resource_product_idx').bind('change',function(){resource_product_change()});var today=$('#booking_date').data('today');var working_day_list=$('#booking_date').data('working-day');var policy=$('#booking_date').data('policy');update_working_time_list(today);var datepicker=$('#booking_date').datepicker({minDate:today,uiLibrary:'bootstrap4',format:'yyyy-mm-dd',locale:'zh-tw',disableDates:function(date){var mm=date.getMonth()+1;var dd=date.getDate();var date_string=[date.getFullYear(),(mm>9?'':'0')+mm,(dd>9?'':'0')+dd].join('-');var res=(working_day_list.indexOf(date_string)==-1);if(policy=='on')
res=!res;return res},change:function(e){var booking_date=$('#booking_date').val();update_working_time_list(booking_date)}})});function update_working_time_list(date){if(date==undefined)
return;var url=$('#booking_time').data('url')
if(url==undefined||url=='')
return;url=url+'/'+date;$.get(url,function(res){$('#booking_time').html(res)})}
function resource_product_change(){var resource_product_idx=$('#resource_product_idx').val();var url=$('#resource_product_idx').data('url');if(url==undefined||url=='')
return;url=url+'/'+resource_product_idx;window.location=url}
function booking_checkout(){var booking_date=$('#booking_date').val();var resource_product_idx=$('#resource_product_idx').val();var booking_time=$('#booking_time').val();var url=$('#booking_checkout').data('url')
if(resource_product_idx==null){swal('請選擇服務項目');return}
if(booking_date==null||booking_date.length==0){swal('請選擇服務日期');return}
if(booking_time!==undefined){if(booking_time==null||booking_time.length==0){swal('請選擇服務時間');return}
if(booking_time==null||booking_time.length==0){swal('請選擇服務時間');return}}else{booking_time=null}
window.location=url+'?resource_product_idx='+resource_product_idx+'&booking_date='+booking_date+'&booking_time='+booking_time};var shipment_with_payment=!1;var store_to_store=!1;$(function(){$('#store_to_store_area').hide();$('#block_triplicate').hide();$('input[name=shipment], input[name=shipment_idx]').on('change',function(event){shipment_change()});$('input[name=payment]').on('change',function(event){payment_change()});$('input[name=invoice_type]').on('change',function(event){invoice_type_change()});$('input[name=payment]:first').prop('checked',!0);$('input[name=invoice_type]:first').prop('checked',!0);shipment_change();payment_change()});function refresh_cart(){var url=$('#cart_list').data('url');if(url==undefined||url.length==0)
return;$.get(url,function(res){$('#cart_list').html(res.html);$('#mobile_cart_quantity').html(res.total_quantity);$('#pc_cart_quantity').html(res.total_quantity)},'json')}
function add_to_cart(product_idx){var url='cart/add';var quantity=$('#quantity').val();if(p2s_idx==undefined){swal({title:"購物車",text:"請先選擇規格!!!",type:"warning",}).then(function(result){});return}
$.post(url,{product_idx:product_idx,p2s_idx:p2s_idx,quantity:quantity},function(res){if(res=='ok'){swal({title:"購物車",text:"加入購物車!!!",type:"success",}).then(function(result){location.reload()})}else if(res=='stock_empty'){swal('該商品已無庫存')}else{swal('伺服器異常 請稍後再試')}})}
function remove_from_cart(hash){var url='cart/delete/'+hash;$.post(url,function(res){if(res=='ok'){refresh_cart()}else{swal('更新失敗')}})}
function update_quantity(direct_obj){var input_obj=direct_obj.parentNode.querySelector('input[type=number]');var direct=$(direct_obj).data('direct');if(direct=='up')
input_obj.stepUp();else input_obj.stepDown();var hash=$(input_obj).data('hash');var quantity=$(input_obj).val();var url='cart/update';$.post(url,{hash:hash,quantity:quantity,},function(res){if(res=='ok'){refresh_cart()}else{swal('更新失敗')}})}
function shipment_change(){var url=$('#shipment_area').data('url');if(url==undefined||url.length==0)
return;var shipment=$('input[name=shipment]:checked').val();if(shipment==undefined)
return;if(shipment=='deliver_to_home'){$('#shipment_without_payment_list').show()}else{$('#shipment_without_payment_list').hide()}
if(shipment=='deliver_to_home_with_payment'){$('#shipment_with_payment_list').show()}else{$('#shipment_with_payment_list').hide()}
var shipment_idx=$('input[name=shipment_idx]:checked').val();$.post(url,{shipment:shipment,shipment_idx:shipment_idx,type:'cart',},function(res){if(shipment==undefined)
return;shipment_with_payment=res.with_payment;if(shipment_with_payment||res.final_price==0)
$('#payment_area').hide();else $('#payment_area').show();store_to_store=res.store_to_store;if(store_to_store){$('#store_to_store_area').show();$('#rcpt_address_block').hide()}else{$('#store_to_store_area').hide();$('#rcpt_address_block').show()}
if(shipment=='self_pickup'){$('#rcpt_info_block').hide()}else{$('#rcpt_info_block').show()}
refresh_amount_table(res)},'json')}
function payment_change(){var url=$('#payment_area').data('url');if(url==undefined||url.length==0)
return;var payment=$('input[name=payment]:checked').val();var item_type=$('#order_submit').data('item-type');if(payment==undefined)
return;if(payment=='cc'){$('#cc_installment').show();$('input[name=installment]:first').prop('checked',!0)}else $('#cc_installment').hide();$.post(url,{payment:payment,item_type:item_type,},function(res){if(res.payment_fee==undefined||res.payment_fee==0){$('#payment_fee_block').hide()}else{$('#payment_fee_block').show()}
refresh_amount_table(res)},'json')}
function invoice_type_change(){var invoice_type=$('input[name=invoice_type]:checked').val();if(invoice_type=='duplicate'){$('#block_triplicate').hide()}else{$('#block_triplicate').show()}}
function order_submit(){$('#block_total_price_lowbound').hide();var join_email=$('input[name=join_email]').val();var join_password1=$('input[name=join_password1]').val();var join_password2=$('input[name=join_password2]').val();var join_name=$('input[name=join_name]').val();var join_mobile=$('input[name=join_mobile]').val();var join_address=$('input[name=join_address]').val();var join_zipcode=$('input[name=join_zipcode]').val();var rcpt_name=$('input[name=rcpt_name]').val();var rcpt_tele=$('input[name=rcpt_tele]').val();var rcpt_address=$('input[name=rcpt_address]').val();var rcpt_zipcode=$('input[name=rcpt_zipcode]').val();var payment=$('input[name=payment]:checked').val();var installment=$('input[name=installment]:checked').val();var shipment=$('input[name=shipment]:checked').val();var shipment_idx=$('input[name=shipment_idx]:checked').val();var store_system=$('select[name=store_system]').val();var store_name=$('input[name=store_name]').val();var store_id=$('input[name=store_id]').val();var transfer_last_5digit=$('input[name=transfer_last_5digit]').val();var invoice_type=$('input[name=invoice_type]:checked').val();var company_sn=$('input[name=company_sn]').val();var company_title=$('input[name=company_title]').val();var company_address=$('input[name=company_address]').val();var order_note=$('textarea[name=order_note]').val();if(installment==undefined||installment==null)
installment=0;if(shipment=='store_to_store'||shipment=='store_to_store_with_payment'){if(store_name.length==0){swal('請輸入店名');return}
if(store_id.length==0){swal('請輸入店號');return}}
if(!shipment_with_payment){if(payment===undefined||payment.length==0){swal('請選擇付款方式');return}}
$('#order_submit').prop('href','javascript:void(0)');var url=$('#order_submit').data('order-submit-url');$.post(url,{join_email:join_email,join_password1:join_password1,join_password2:join_password2,join_name:join_name,join_mobile:join_mobile,join_address:join_address,join_zipcode:join_zipcode,rcpt_name:rcpt_name,rcpt_tele:rcpt_tele,rcpt_address:rcpt_address,rcpt_zipcode:rcpt_zipcode,payment:payment,installment:installment,shipment:shipment,shipment_idx:shipment_idx,store_system:store_system,store_name:store_name,store_id:store_id,transfer_last_5digit:transfer_last_5digit,invoice_type:invoice_type,company_sn:company_sn,company_title:company_title,company_address:company_address,order_note:order_note,},function(res){$('#order_submit').prop('href','javascript:order_submit()');if(res.status=='ok'){if(res.is_new_user=='yes'){alert('別忘了到信箱查收會員信，完成會員資料喔')}
window.location=res.cashflow_url}else if(res.status=='err:already_joined'){swal({title:'購物車結帳',html:'<b>您的email已被使用</b><br>'+'如果您已經有會員帳號 請先登入<br>'+'或是<a href="javascript:shop_checkout_switch_to_forget_password_block();">重設密碼</a>'},function(){shop_checkout_switch_to_loin_block()})}else if(res.status=='err:cart_is_empty'){swal({title:"購物車",text:"購物車是空的!!!",type:"success",}).then(function(result){window.location='cart'})}else if(res.status=='err:out_of_stock'){swal('部分商品缺貨 請調整數量後再進行結帳')}else if(res.status=='err:low_than_total_price_lowbound'){swal('低於低銷金額'+res.total_price_lowbound+'(還差'+res.total_price_lowbound_diff+'元)')}else if(res.status=='err:empty_name'){swal('會員姓名空白 請到會員編輯頁面補齊')}else if(res.status=='err:no_join_data'){swal('新註冊用戶缺少 email/密碼/姓名/電話/地址')}else if(res.status=='err:password_empty'){swal('密碼空白')}else if(res.status=='err:password_diff'){swal('兩次輸入的密碼不同')}else if(res.status=='err:password_short_than_8char'){swal('密碼少於8個字元')}else if(res.status=='err:empty_mobile'){swal('聯絡電話空白 請到會員編輯頁面補齊')}else if(res.status=='err:mobile_prefix_09'){swal("電話號碼格式錯誤\n(需09開頭)")}else if(res.status=='err:mobile_10_digits'){swal("電話號碼格式錯誤\n(需10碼數字)")}else if(res.status=='err:empty_address'){swal('缺少寄送地址 請到個人資料頁面填寫')}else if(res.status=='err:empty_join_data'){swal("請填訂購人資訊")}else if(res.status=='err:empty_invoice_type'){swal('請選擇發票種類')}else if(res.status=='err:empty_invoice_data'){swal('缺少三聯式發票資料')}else if(res.status=='err:empty_payment'){swal('請選擇付款方式')}else if(res.status=='err:empty_transfer_last_5digit'){swal('請輸入匯款後五碼')}else if(res.status=='err:empty_shipment'){swal('請選擇運送方式')}else{swal('伺服器異常')}},'json')}
function open_map_window(type){var join_email=$('input[name=join_email]').val();var join_name=$('input[name=join_name]').val();var join_mobile=$('input[name=join_mobile]').val();var join_zipcode=$('input[name=join_zipcode]').val();var join_address=$('input[name=join_address]').val();var rcpt_name=$('input[name=rcpt_name]').val();var rcpt_tele=$('input[name=rcpt_tele]').val();var rcpt_zipcode=$('input[name=rcpt_zipcode]').val();var rcpt_address=$('input[name=rcpt_address]').val();var invoice_type=$('input[name=invoice_type]:checked').val();var company_sn=$('input[name=company_sn]').val();var company_title=$('input[name=company_title]').val();var company_address=$('input[name=company_address]').val();var order_note=$('textarea[name=order_note]').val();$.post('cart/set_cart_field',{join_email:join_email,join_name:join_name,join_mobile:join_mobile,join_zipcode:join_zipcode,join_address:join_address,rcpt_name:rcpt_name,rcpt_tele:rcpt_tele,rcpt_zipcode:rcpt_zipcode,rcpt_address:rcpt_address,invoice_type:invoice_type,company_sn:company_sn,company_title:company_title,company_address:company_address,order_note:order_note,},function(res){var url="cart/map/"+type;window.location=url})}
function refresh_amount_table(res){if(res.coupon_discount_value!==undefined){if(res.coupon_discount_value>0)
$('#coupon_discount_block').show();else $('#coupon_discount_block').hide()}
if(res.payment_fee_value!==undefined){if(res.payment_fee_value>0)
$('#payment_fee_block').show();else $('#payment_fee_block').hide()}
if(res.final_price_value!==undefined){if(res.final_price_value>0)
$('#payment_area').show();else $('#payment_area').hide()}
if(res.total_price!==undefined)
$('#total_price').html(res.total_price);if(res.shipping_fee!==undefined)
$('#shipping_fee').html(res.shipping_fee);if(res.payment_fee!==undefined)
$('#payment_fee').html(res.payment_fee);if(res.coupon_discount!==undefined)
$('#coupon_discount').html(res.coupon_discount);if(res.total_vip_discount!==undefined)
$('#total_vip_discount').html(res.total_vip_discount);if(res.final_price!==undefined)
$('#final_price').html(res.final_price);};function submit_comment(){var comment=$('#comment').html();var rating=$('input[name=rating]').val();var url=$('#submit_comment').data('url');$.post(url,{comment:comment,rating:rating,},function(res){if(res=='ok'){swal({title:"留言區",text:"留言成功!!!",type:"success",}).then(function(result){location.reload()})}else if(res=='no_login'){swal('請先登入')}else{swal('伺服器錯誤')}})};function contact_submit(){var name=$('input[name=name]').val();var tele=$('input[name=tele]').val();var email=$('input[name=email]').val();var message=$('textarea[name=message]').val();var site_key=$('#contact_submit').data('sitekey');grecaptcha.execute(site_key,{action:'submit'}).then(function(captcha){$('#contact_submit').unbind('click');$.post('contact/submit',{name:name,tele:tele,email:email,message:message,captcha:captcha,},function(res){contact_bind_click();if(res.status=='ok'){swal({title:"聯絡我們",text:"訊息已經送出!!!",type:"success",}).then(function(result){location.reload()})}else{swal(res.error_message)}},'json')})}
$(function(){contact_bind_click()});function contact_bind_click(){$('#contact_submit').bind('click',function(){contact_submit()})};function get_message_by_coupon_error_code(res){var message='';if(res.code=='coupon:code_error')
message='折扣碼不存在';if(res.code=='coupon:item_error')
message='折扣碼不適用此商品/活動/課程';if(res.code=='coupon:date_error')
message='折扣碼不在使用日期內/已過期';if(res.code=='coupon:out_of_budget')
message='折扣碼額度已使用完畢';if(res.code=='coupon:used')
message='折扣碼已使用';if(res.code=='coupon:has_min_order_amount')
message='折扣碼需購買超過'+res.min_order_amount+'元才能使用';if(res.code=='coupon:not_over_coupon_amount')
message='未超過設定之總消費金額';if(res.code=='coupon:not_in_user_list')
message='折扣碼非約定的使用者';if(res.code=='coupon:code_empty')
message='折扣碼空白';if(res.code=='coupon:cart_without_coupon_target_product')
message='購物車中沒有折扣碼指定的折扣產品';if(res.code=='coupon:code_not_enabled')
message='折扣碼未開通';if(res.code=='coupon:not_available')
message='折扣碼無法使用';return message}
function set_coupon_code(input_object){var url=$(input_object).data('url-set-coupon-code');var coupon_code=$(input_object).val();if(url==undefined||url=='')
return;if(coupon_code==undefined||coupon_code=='')
return;$.post(url,{coupon_code:coupon_code,},function(res){if(res.status=='ok'){$('#coupon_status').hide();$('#coupon_status').html('')}else{var message=get_message_by_coupon_error_code(res);$('#coupon_status').html(message);$(input_object).val('');$('#coupon_status').show();$('#coupon_discount').html(res.coupon_discount)}
refresh_amount_table(res)},'json')}
function clear_coupon_code(input_object){$(input_object).val('');var url=$(input_object).data('url-reset-coupon-code');if(url==undefined||url=='')
return;$.get(url,function(res){refresh_amount_table(res)},'json')};$(function(){var section_idx=$('#course_video').data('section-idx');var player_type=$('#course_video').data('type');if(section_idx!=undefined){var player=null;if(player_type=='vimeo')
player=new Vimeo.Player('course_video');if(player_type=='youtube'||player_type=='aten'){player=videojs('course_video');player.hlsQualitySelector()}
set_course_player_playbackrate(player,player_type);set_course_player_playbackposition(player,player_type)}})
function set_course_player_playbackposition(player,player_type){var section_idx=$('#course_video').data('section-idx');var playback_position=$.cookie('course_playback_position_'+section_idx);if(playback_position!=undefined&&playback_position!=null){if(player_type=='vimeo')
player.setCurrentTime(playback_position);if(player_type=='youtube'||player_type=='aten')
player.currentTime(playback_position);}
player.on('timeupdate',function(data){var section_idx=$('#course_video').data('section-idx');var playback_position=null;if(player_type=='vimeo')
playback_position=data.seconds;if(player_type=='youtube'||player_type=='aten')
playback_position=player.currentTime();if(playback_position!=null){$.cookie('course_playback_position_'+section_idx,playback_position)}});player.on('ended',function(data){$.cookie('course_playback_position_'+section_idx,0);setTimeout(function(){complete_and_go_to_next_section()},5000)})}
function set_course_player_playbackrate(player,player_type){var playback_rate=$.cookie('course_playback_rate');if(playback_rate!==undefined&&playback_rate!==null){change_video_play_speed(playback_rate,player_type,player)}
if(player_type=='vimeo'){player.on('playbackratechange',function(data){playback_rate=data.playbackRate;write_playback_rate_to_cookie(playback_rate)})}
if(player_type=='youtube'||player_type=='aten'){player.on('ratechange',function(data){playback_rate=player.playbackRate();write_playback_rate_to_cookie(playback_rate)})}}
function write_playback_rate_to_cookie(playback_rate){if(playback_rate==undefined||playback_rate==null)
playback_rate=1;$.cookie('course_playback_rate',playback_rate)}
function change_video_play_speed(playback_rate,player_type,player){if(player_type==undefined||player_type==null){player_type=$('#course_video').data('type')}
if(player==undefined||player==null){if(player_type=='vimeo')
player=new Vimeo.Player('course_video');if(player_type=='youtube'||player_type=='aten')
player=videojs('course_video');}
if(player_type=='vimeo')
player.setPlaybackRate(playback_rate);if(player_type=='youtube'||player_type=='aten')
player.playbackRate(playback_rate);}
function complete_and_go_to_next_section(){var url=$('#button_complete_and_go_to_next_section').data('url');$.get(url,function(res){if(res.status=='ok'){window.location=res.url}else if(res.status=='no_section'){window.location="course"}else if(res.status=='no_next_section'){swal('已到最後一節')}},'json')}
function go_to_next_uncompleted_section(){var url=$('#button_go_to_next_uncompleted_section').data('url');$.get(url,function(res){if(res.status=='ok'){window.location=res.url}else if(res.status=='no_section'){window.location="course"}else if(res.status=='no_login'){swal('下個章節需要登入才能觀看')}else if(res.status=='no_next_section'){swal('已到最後一節')}},'json')}
function add_to_course_cart(){var url=$('#course_add_to_cart_button').data('url');var spec=$('select[name=course_spec]').val();if(url.length==0||url==undefined)
return;if(spec.length==0||spec==undefined)
return;var arr=JSON.parse(spec);var type=arr.type;var number_of_people=arr.number_of_people;if(number_of_people==undefined)
number_of_people=1;var url=url+'?quantity='+number_of_people;window.location=url}
function course_search(){var keyword=$('#blog_search_keyword').val();if(keyword.length==0)
return;var url="course/search/"+encodeURIComponent(keyword).replace(/[!'()*]/g,function(c){return'%'+c.charCodeAt(0).toString(16)});window.location=url};$(function(){$(".fixed-bottom-popup .close-btn").click(function(){$(this).parents(".fixed-bottom-popup").fadeOut("fast");$.cookie('edm_subscription_sidebar','closed',{expires:365})});var status=$.cookie('edm_subscription_sidebar');if(status==undefined){$.cookie('edm_subscription_sidebar','opened',{expires:365});status='opened'}
if(status=='opened')
$('#edm_subscription_sidebar').show();});function submit_edm_subscription_email(obj_id){var email=$('#'+obj_id).val();var url=$('#'+obj_id).data('url');if(email.length==0){swal('請填寫email');return}
$.post(url,{email:email},function(res){if(res=='ok')
swal('訂閱成功');else if(res=='err:email_format'){swal('email格式錯誤')}else{swal('伺服器錯誤')}})};function show_event_notice_me_form(event_idx){$.get('event/get_notice_me_form/'+event_idx,function(res){$('#event_open').html(res);$('#event_open').modal();$('#event_open').show()})}
function show_event_notice_me_form_already_login(url){$.post(url,function(res){if(res=='ok')
show_event_notice_me_completed();else if(res=='existed')
swal('已經加入過了');else swal('伺服器錯誤')})}
function event_notice_me_send_email(){var url=$('#event_open').data('email-only-submit-url');var email=$('#notice_me_email').val();$.post(url,{email:email,},function(res){if(res=='ok')
show_event_notice_me_completed();else if(res=='existed')
swal('已經加入過了');else swal('伺服器錯誤')})}
function show_event_notice_me_completed(){$.get('event/get_notice_me_completed',function(res){$('#event_open').modal('hide');$('#event_completed').html(res);$('#event_completed').modal();$('#event_completed').show()})}
function event_join(){var attendance=$('select[name=attendance]').val();if(attendance==undefined||attendance=='')
attendance=1;var url=$('#event_join_button').data('url');url+='?attendance='+attendance;window.location=url};;$(function(){$('#toggle_password').bind('click',function(){toggle_password()});$('#join_submit').bind('click',function(){join_submit()})
$('#login').bind('click',function(){login()})
$('#update_submit').bind('click',function(){update_submit()})
$('#update_password_button').bind('click',function(){update_password_submit()})
$('#resend_activate_code').bind('click',function(){resend_activate_code()})
$('#button_reset_password').bind('click',function(){forget_password_submit()})
$('#button_reset_new_password').bind('click',function(){reset_new_password()})
$('#new_password2').bind('keyup',function(){var new_password1=$('#new_password1').val();var new_password2=$('#new_password2').val();if(new_password1==new_password2){$('#new_password2').addClass('is-valid');$('#new_password2').removeClass('is-invalid')}else{$('#new_password2').removeClass('is-valid');$('#new_password2').addClass('is-invalid')}});refresh_menu_user_info()});function refresh_menu_user_info(){var url=$('#menu_pc_user_status').data('url');if(url==undefined||url=='')
return;$.get(url,function(html){$('#menu_pc_user_status').html(html)})}
var recaptcha_is_ready=function(){$('#join_submit').prop('disabled',!1)};function join_submit(){var email=$('input[name=email]').val();var user_password1=$('input[name=user_password1]').val();var user_password2=$('input[name=user_password2]').val();var name=$('input[name=name]').val();var mobile=$('input[name=mobile]').val();var zipcode=$('input[name=zipcode]').val();var address=$('input[name=address]').val();var subscribe_edm=$('input[name=subscribe_edm]').is(":checked");var site_key=$('#join_submit').data('sitekey');if(email.length==0){swal('請輸入Email');return}
if(user_password1.length<8){swal('密碼過短, 至少要8個字元');return}
if(user_password1!=user_password2){swal('兩次密碼不同');return}
var submit_url=$('#join_submit').data('submit-url');var redir_url=$('#join_submit').data('redir-url');grecaptcha.execute(site_key,{action:'submit'}).then(function(captcha){$.post(submit_url,{email:email,user_password1:user_password1,user_password2:user_password2,name:name,mobile:mobile,zipcode:zipcode,address:address,subscribe_edm:subscribe_edm,captcha:captcha,},function(res){if(res=='ok'){swal({title:"會員中心",text:"加入成功, 已寄出驗證信到您的信箱\n記得點驗證信中的連結才能登入喔",type:"success",}).then(function(result){window.location=redir_url})}else if(res=='empty:email'){swal('Email空白')}else if(res=='err:email_format'){swal('Email格式錯誤')}else if(res=='empty:user_password1'){swal('密碼空白')}else if(res=='empty:password_too_short'){swal('密碼過短(至少8個字元)')}else if(res=='empty:password_too_short'){swal('兩次密碼不同')}else if(res=='empty:email'){swal('姓名空白')}else if(res=='empty:mobile'){swal('電話空白')}else if(res=='empty:zipcode'){swal('郵遞區號空白')}else if(res=='err:user_existed'){swal('會員已經存在')}else if(res=='err:mobile_prefix_09'){swal("電話號碼格式錯誤\n(需09開頭)")}else if(res=='err:mobile_10_digits'){swal("電話號碼格式錯誤\n(需10碼數字)")}else if(res=='err:captcha'){swal('認證碼錯誤');grecaptcha.reset()}else{swal('伺服器異常')}})})}
function login(){var email=$('input[name=email]').val();var user_password=$('input[name=user_password]').val();var redir_url=$('#login').data('redir-url');var login_url=$('#login').data('login-url');if(email.length==0){swal('請輸入Email');return}
if(user_password.length==0){swal('請輸入密碼');return}
$.post(login_url,{email:email,user_password:user_password},function(res){if(res=='ok'){swal({title:"會員中心",text:"登入成功",type:"success",}).then(function(result){window.location=redir_url})}else if(res=='not_activated'){swal({title:"會員中心",text:"帳號尚未啟用",type:"warning",}).then(function(result){window.location=redir_url})}else if(res=='err:locked'){swal({title:"會員中心",text:"此帳號已失效",type:"warning",}).then(function(result){})}else{swal('登入失敗')}})}
function update_submit(){var name=$('input[name=name]').val();var mobile=$('input[name=mobile]').val();var zipcode=$('input[name=zipcode]').val();var address=$('input[name=address]').val();var redir_url=$('#update_submit').data('redir-url');var subscribe_edm=$('input[name=subscribe_edm]').is(":checked");var edit_submit_url=$('#update_submit').data('edit-submit-url');if(name.length==0){swal('請輸入姓名');return}
if(mobile.length==0){swal('請輸入手機號碼');return}
if(zipcode.length==0){swal('請輸入郵遞區號');return}
if(address.length==0){swal('請輸入地址');return}
$.post(edit_submit_url,{name:name,mobile:mobile,zipcode:zipcode,address:address,subscribe_edm:subscribe_edm,},function(res){if(res=='ok'){swal({title:"會員中心",text:"更新成功",type:"success",}).then(function(result){window.location=redir_url})}else if(res=='err:mobile_prefix_09'){swal("電話號碼格式錯誤\n(需09開頭)")}else if(res=='err:mobile_10_digits'){swal("電話號碼格式錯誤\n(需10碼數字)")}else{swal('伺服器異常')}})}
function update_password_submit(){var old_password=$('input[name=old_password]').val();var new_password1=$('input[name=new_password1]').val();var new_password2=$('input[name=new_password2]').val();var redir_url=$('#update_password_button').data('redir-url');var update_url=$('#update_password_button').data('update-url');var no_old_password=($('#update_password_button').data('no-old-password')=='yes');if(!no_old_password&&old_password.length==0){swal('請輸入現在密碼');return}
if(new_password1.length==0){swal('請輸入新密碼');return}
if(new_password2.length==0){swal('請輸入新密碼確認');return}
if(new_password1!=new_password2){swal('新密碼不一致');return}
$.post(update_url,{old_password:old_password,new_password1:new_password1,new_password2:new_password2,},function(res){if(res=='ok'){swal({title:"會員中心",text:"更新成功",type:"success",}).then(function(result){window.location=redir_url})}else if(res=='old_password_err'){swal({title:"會員中心",text:"現在密碼錯誤",type:"warning",}).then(function(result){window.location=redir_url})}else if(res=='password_too_short'){swal({title:"會員中心",text:"新密碼長度錯誤",type:"warning",}).then(function(result){window.location=redir_url})}else if(res=='password_diff'){swal({title:"會員中心",text:"新密碼確認錯誤",type:"warning",}).then(function(result){window.location=redir_url})}else{swal('伺服器異常')}})}
function resend_activate_code(){var email=$('input[name=email]').val();var redir_url=$('#resend_activate_code').data('redir-url');var submit_url=$('#resend_activate_code').data('submit-url');if(email.length==0){swal('請輸入email資料');return}
$.post(submit_url,{email:email,},function(res){swal({title:"會員中心",text:"重寄驗證信成功",type:"success",}).then(function(result){window.location=redir_url})})}
function forget_password_submit(){var reset_password_url=$('#button_reset_password').data('reset-password-url');var login_url=$('#button_reset_password').data('login-url');var email=$('#email').val();var site_key=$('#button_reset_password').data('sitekey');if(email.length==0){swal('請輸入Email');return}
if(reset_password_url==undefined)
return;grecaptcha.execute(site_key,{action:'submit'}).then(function(captcha){$.post(reset_password_url,{email:email,captcha:captcha},function(res){if(res=='ok'){swal({title:"Forget Password",text:"密碼通知信已寄出",type:"success",}).then(function(result){window.location=login_url})}else if(res=='err:not_existed'){swal({title:"Forget Password",text:"您可能尚未建立會員或輸入錯誤email",type:"error",}).then(function(result){location.reload()})}else if(res=='err:captcha'){swal({title:"Forget Password",text:"驗證碼錯誤",type:"error",}).then(function(result){})}else{swal({title:"Forget Password",text:"Server Error",type:"error",}).then(function(result){})}})})}
function reset_new_password(){var reset_completed_url=$('#button_reset_new_password').data('reset-completed-url');var reset_password_url=$('#button_reset_new_password').data('reset-password-url');var new_password1=$('input[name=new_password1]').val();var new_password2=$('input[name=new_password2]').val();if(new_password1.length==0){swal('新密碼空白');return}
if(new_password2.length==0){swal('新確認密碼空白');return}
if(new_password1!=new_password2){swal('兩次密碼不同');return}
if(new_password1.length<8){swal('密碼過短(請輸入大於8個字元)');return}
$.post(reset_password_url,{new_password1:new_password1,new_password2:new_password2},function(res){if(res=='ok'){swal({title:"Forget Password",text:"密碼已經重置",type:"success",}).then(function(result){window.location=reset_completed_url})}else{swal({title:"Forget Password",text:"Server Error",type:"error",}).then(function(result){})}})}
function fb_login(obj){var url=$(obj).data('set-fb-login-redirect-url');var redirect_url=$(obj).data('fb-login-redirect-url');var fb_login_url=$(obj).data('fb-login-url');$.post(url,{redirect_url:redirect_url},function(){window.location=fb_login_url})}
function toggle_password(){var type=$('#user_password').prop('type');var new_type=((type)==='password')?'text':'password';$('#user_password').prop('type',new_type);var eye_class=$('#toggle_password').prop('class');if(eye_class=='far fa-eye'){$('#toggle_password').prop('class','far fa-eye-slash')}else{$('#toggle_password').prop('class','far fa-eye')}};var p2s_idx=null;$(function(){$('#spec_list > li, #standard-mobile > li').bind('click',function(){var quota=$(this).data('quota');$('#product_stock_pc').html('尚有'+quota+'個商品');$('#product_stock_pc').show();$('#product_stock_mobile').html('尚有'+quota+'個商品');$('#product_stock_mobile').show();p2s_idx=$(this).data('idx');var show_original_price=$(this).data('show-original-price');var original_price=$(this).data('original-price');var special_price=$(this).data('special-price');var currency=$(this).data('currency');$('#spec_original_price_pc').html(original_price);$('#spec_special_price_pc').html(special_price);$('#spec_original_price_mobile').html(original_price);$('#spec_special_price_mobile').html(special_price);if(show_original_price=='yes'){$('#price_set_original_price_pc').show();$('#price_set_original_price_mobile').show()}else{$('#price_set_original_price_pc').hide();$('#price_set_original_price_mobile').hide()}
$('#block_preset_price_pc').hide();$('#block_spec_price_pc').show();$('#block_preset_price_mobile').hide();$('#block_spec_price_mobile').show();$(this).removeClass('chosen');$(this).addClass('chosen')})});function product_search(){var keyword=$('#product_search_keyword').val();if(keyword.length==0)
return;var url="product/search/"+encodeURIComponent(keyword).replace(/[!'()*]/g,function(c){return'%'+c.charCodeAt(0).toString(16)});window.location=url}
$(function(){$('#product_search_keyword').keypress(function(e){if(e.which==13)
product_search();})});function quick_order_submit(){var join_email=$('input[name=join_email]').val();var join_password1=$('input[name=join_password1]').val();var join_password2=$('input[name=join_password2]').val();var join_name=$('input[name=join_name]').val();var join_mobile=$('input[name=join_mobile]').val();var payment=$('input[name=payment]:checked').val();var installment=$('input[name=installment]:checked').val();var invoice_type=$('input[name=invoice_type]:checked').val();var company_sn=$('input[name=company_sn]').val();var company_title=$('input[name=company_title]').val();var company_address=$('input[name=company_address]').val();var transfer_last_5digit=$('input[name=transfer_last_5digit]').val();var order_note=$('textarea[name=order_note]').val();var url=$('#order_submit').data('order-submit-url');if(url==undefined||url.length==0)
return;if(installment==undefined||installment==null)
installment=0;$.post(url,{join_email:join_email,join_password1:join_password1,join_password2:join_password2,join_name:join_name,join_mobile:join_mobile,payment:payment,installment:installment,invoice_type:invoice_type,company_sn:company_sn,company_title:company_title,company_address:company_address,transfer_last_5digit:transfer_last_5digit,order_note:order_note,},function(res){if(res.status=='ok'){if(res.is_new_user=='yes'){alert('別忘了到信箱查收會員信，完成會員資料喔')}
window.location=res.cashflow_url}else if(res.status=='err:already_joined'){swal({title:'購物車結帳',html:'<b>您的email已被使用</b><br>'+'如果您已經有會員帳號 請先登入<br>'+'或是<a href="javascript:quick_checkout_show_forget_password();">重設密碼</a>'},function(){quick_checkout_show_login()})}else if(res.status=='err:empty_name'){swal('會員姓名空白 請到會員編輯頁面補齊')}else if(res.status=='err:no_join_data'){swal('新註冊用戶缺少 email/密碼/姓名/電話/地址')}else if(res.status=='err:password_empty'){swal('密碼空白')}else if(res.status=='err:password_diff'){swal('兩次輸入的密碼不同')}else if(res.status=='err:password_short_than_8char'){swal('密碼少於8個字元')}else if(res.status=='err:empty_mobile'){swal('聯絡電話空白 請到會員編輯頁面補齊')}else if(res.status=='err:mobile_prefix_09'){swal("電話號碼格式錯誤\n(需09開頭)")}else if(res.status=='err:mobile_10_digits'){swal("電話號碼格式錯誤\n(需10碼數字)")}else if(res.status=='err:empty_address'){swal('缺少寄送地址 請到個人資料頁面填寫')}else if(res.status=='err:empty_invoice_type'){swal('請選擇發票種類')}else if(res.status=='err:empty_invoice_data'){swal('缺少三聯式發票資料')}else if(res.status=='err:empty_payment'){swal('請選擇付款方式')}else if(res.status=='err:empty_transfer_last_5digit'){swal('請輸入匯款後五碼')}else{alert('伺服器異常')}},'json')};$(function(){$('#shop_checkout_link_join_to_login, #shop_checkout_link_forget_password_to_login').click(function(){shop_checkout_switch_to_loin_block()});$('#shop_checkout_link_join_to_forget_password, #shop_checkout_link_login_to_forget_password').click(function(){shop_checkout_switch_to_forget_password_block()});$('#shop_checkout_link_login_to_join, #shop_checkout_link_forget_password_to_join').click(function(){shop_checkout_switch_to_join_block()})});function shop_checkout_switch_to_loin_block(){var join_block=$('#block_user_join');var loin_block=$('#block_user_login');var forget_password_block=$('#block_forget_password');$(loin_block).delay(300).fadeIn(500);$(join_block).fadeOut(300);$(forget_password_block).fadeOut(300);sweetAlert.close()}
function shop_checkout_switch_to_forget_password_block(){var join_block=$('#block_user_join');var loin_block=$('#block_user_login');var forget_password_block=$('#block_forget_password');$(forget_password_block).delay(300).fadeIn(500);$(join_block).fadeOut(300);$(loin_block).fadeOut(300);sweetAlert.close()}
function shop_checkout_switch_to_join_block(){var join_block=$('#block_user_join');var loin_block=$('#block_user_login');var forget_password_block=$('#block_forget_password');$(join_block).delay(300).fadeIn(500);$(loin_block).fadeOut(300);$(forget_password_block).fadeOut(300);sweetAlert.close()}
function shop_checkout_login(){var email=$('input[name=login_email]').val();var user_password=$('input[name=login_password]').val();var url=$('#shop_checkout_login').data('order-login-url');if(url==undefined||url.length==0)
return;$.post(url,{user_id:email,user_password:user_password,},function(res){if(res.status=='ok'){var info_block=$('#block_user_info');var join_block=$('#block_user_join');var loin_block=$('#block_user_login');var forget_password_block=$('#block_forget_password');info_block.show();join_block.hide();loin_block.hide();forget_password_block.hide();$('#current_user_name').html('姓名：'+res.user_name);$('#current_user_id').html('Email：'+res.user_id);refresh_menu_user_info();shop_checkout_get_shipping_data();shop_checkout_get_shopping_list()}else if(res.status=='err'){swal('登入失敗')}else{swal('登入失敗')}},'json')}
function shop_checkout_get_shipping_data(){$.get('member/get_shipping_data',function(res){if(res.status=='no_login'){return}else{$('input[name=rcpt_name]').val(res.rcpt_name);$('input[name=rcpt_tele]').val(res.rcpt_tele);$('input[name=rcpt_address]').val(res.rcpt_address)}},'json')}
function shop_checkout_get_shopping_list(){$.get('cart/get_shopping_list',function(res){$('#shopping-list').html(res)})}
function shop_checkout_reset_password_submit(email){if(email==undefined){email=$('input[name=join_email]').val()}
if(email.length==0){sweetAlert({title:'購物車結帳',text:'請輸入email'},function(){});return}
var url=$('#order_submit').data('reset-password-url');if(url==undefined||url.length==0)
return;var site_key=$('#forget_password_button').data('sitekey');grecaptcha.execute(site_key,{action:'submit'}).then(function(captcha){$.post(url,{email:email,captcha:captcha,},function(res){sweetAlert({title:'購物車結帳',text:'新密碼已經送到您的信箱'},function(){})})})};function subscription_plan_join(plan_idx){var attendance=$('select[name=attendance]').val();if(attendance==undefined||attendance=='')
attendance=1;var url=$('#plan_join_button').data('url');window.location=url};function consume_credit_for_media(){var url=$('#consume_credit_for_media').data('url');$.get(url,function(res){if(res.status=='ok'){swal('已扣除點數, 您還剩餘'+res.credit_left+'點').then((result)=>{location.reload()})}else if(res.status=='err:not_login'){swal('請先登入')}else if(res.status=='err:already_open'){swal('權限已經開過囉')}else if(res.status=='err:credit_not_enough'){swal('點數不足')}},'json')};function blog_search(){var keyword=$('#blog_search_keyword').val();if(keyword.length==0)
return;var url="blog/search/"+encodeURIComponent(keyword).replace(/[!'()*]/g,function(c){return'%'+c.charCodeAt(0).toString(16)});window.location=url};function page_collect_email(){var url=$('#page_collect_email').data('url');var name=$('input[name=name]').val();var email=$('input[name=email]').val();$.post(url,{name:name,email:email,},function(res){if(res.status=='ok'){window.location=res.redir_url}else{alert(res.message)}},'json')}